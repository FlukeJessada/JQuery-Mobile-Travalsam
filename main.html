<!DOCTYPE html> 
<html> 
	<head> 
	<meta charset='UTF-8'>
	<title>Travalsam</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css" />
	<script src="js/jquery.excoloSlider.min.js"></script>
	<link href="css/jquery.excoloSlider.css" rel="stylesheet">
	<style>
		img {			
			border: 1px solid #3e2b14;
			padding: 0px;			
		}
		table {
			border-radius: 10px;
		}
	</style>
</head> 
<body> 
<div>
	<div data-role="header" data-position="fixed">
		<div id="header-left">
			<a href="#" class="ui-btn-left ui-btn ui-btn-b ui-btn-inline ui-mini ui-corner-all ui-btn-icon-notext ui-icon-bars">menu</a>
		</div>
		<h1 id="headers">Travalsam</h1>
		<div id="header-right">
			<a href="#" class="ui-btn-right ui-btn ui-btn-b ui-btn-inline ui-mini ui-corner-all ui-btn-icon-notext ui-icon-search">search</a>
		</div>
	</div>
	<div id="showslide"></div>
	<div class="ui-body">
		<strong id='topic_form'><font color='#3b2f29' ><br><b>ค้นหา <i>สถานที่ท่องเที่ยว</i> </b></font></strong>
		<form id='form'>
			<table width='100%'>
				<tr> 
					<td width='99%'><input type='text' name='dkey'> </td>
					<td width='1%'>
						<input 														
							data-icon='search' 
							data-iconpos='notext'
							type='button' 
							onclick='return F_TRAVELSEARCH();' 							
						>
					</td>
				</tr>
			</table>		
		</form>
		<p id='topic' style="text-align: center"><b>สำหรับคุณ</b></p>
		<div id='showpage'></div>
		<script>	
			var host = "http://127.0.0.1/travel/api/";	
			var btn_back = 	"<a href='' class='ui-btn-left ui-btn ui-btn-b ui-btn-inline "+
							"ui-mini ui-corner-all ui-btn-icon-notext ui-icon-carat-l' onclick='F_GORELOAD()'>back</a>";
			var listview_data = '';
			$(function F_RECOMMANDED(){
				$.ajax({					
					url 	: host+"api_tavel.php",
					async	: false,
					success : function(result){
						var myjson = $.parseJSON(result);
						listview_data = "";
						$.each(myjson, function(index , val){							
							listview_data +=
							"<a href='' onclick='F_TRAVELDETAIL("+val.id+")'>"+
							"<img src='images/"+val.image+"' width='100%' data-plugin-slide-caption='<p>"+val.name+"</p>'></a>";
						});
					}					
				});				
				$('#showslide').html("<div id='slider'>" + listview_data + "</div>");
				$(function () {
					$("#slider").excoloSlider();
				});	
			});
			$(function F_TRAVEL(){
				$.ajax({					
					url 	: host+"api_tavel.php",
					async	: false,
					success : function(result){
						var myjson = $.parseJSON(result);
						listview_data = "<ul data-role='listview' data-inset='true' class='ui-listview ui-listview-inset ui-corner-all ui-shadow'>";
						$.each(myjson, function(index , val){							
							listview_data +=
							"<li class='ui-li-has-thumb'><a href='' class='ui-btn ui-btn-icon-right ui-icon-carat-r' onclick='F_TRAVELDETAIL("+val.id+")'><img src='images/"+val.image+"' width='100%'>"+
							"<h2>"+val.name+"</h2></a></li>";
						});
						listview_data += "</ul>";
					}					
				});				
				$('#showpage').html(listview_data);
			});
			
			function F_TRAVELSEARCH(){
				$.ajax({
					data 	: $('#form').serialize(),
					type 	: "POST",
					url 	: host+"api_tavel_search.php",
					async	: false,
					success : function(result){
						var myjson = $.parseJSON(result);
						listview_data = "";
						$.each(myjson, function(index , val){							
							listview_data +=								
							"<table border='1' width='100%' style='margin-bottom:14px'>"+
							"<tr>"+
								"<td>"+
									"<h4 align='center'>"+val.name+"</h4>"+
									"<img src='images/"+val.image+"' width='100%'>"+								
									"<div data-role='controlgroup'>"+
										"<a class='ui-btn' onclick='F_TRAVELDETAIL("+val.id+");' data-role='button'>แนะนำข้อมูล</a>"+
										"<a class='ui-btn' onclick='F_GOMAPS(\""+val.latitude+"\", \""+val.longitude+"\");' data-role='button'>แผนที่</a>"+
									"</div>"+
								"</td>"+	
							"</tr>";
							"</table>";
						});						
					}					
				});				
				$('#showpage').html(listview_data);
			}
			
			function F_TRAVELDETAIL(p1){				
				var tvObj 	= {"dkey":p1}
				var tvJSON = JSON.stringify(tvObj);
				var names	= '';
				$.ajax({
					type	: 'POST',
					data	: "data="+tvJSON,					
					url 	: host+"api_tavel_detail.php",
					async	: false,
					success : function(result){
						var myjson = $.parseJSON(result);						
						names = myjson.name;
						listview_data_detail = "";
						listview_data_detail +=	
						"<div class='ui-grid-solo'><div class='ui-block-a'>"+
						"<div data-role='collapsible' data-mini='true'><h4>ข้อมูลเพิ่มเติม</h4>"+
						"<p>"+myjson.detail+"</p></div></div>"+
						"<div class='ui-grid-a'><div class='ui-block-a'>"+
						"<a class='ui-shadow ui-btn ui-corner-all' onclick='F_GOMAPS(\""+myjson.latitude+"\", \""+myjson.longitude+"\");'>Streetview</a></div>"+
						"<div class='ui-block-b'><a class='ui-shadow ui-btn ui-corner-all'>นำทาง</a></div></div></div>";
					}					
				});

				$('#showpage').html(listview_data_detail);
				$('#topic_form').hide();
				$('#form').hide();
				$('#headers').html(names);
				$('#topic').hide();
				$('#header-left').html(btn_back);
			}
			function F_GOMAPS(p1, p2) {				
				localStorage.setItem("l_latitude", p1);
				localStorage.setItem("l_longitude", p2);
				window.location = "maps.html"; 
			}
			function F_GORELOAD() {						
				location.reload(); 
			}
		</script>
	</div>		
</div>
</body>
</html>